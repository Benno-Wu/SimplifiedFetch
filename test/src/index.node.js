"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("stream"),t=require("http"),n=require("url"),r=require("https"),o=require("zlib");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=s(e),l=s(t),a=s(n),u=s(r),c=s(o);function f(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}const p=Function.prototype.call.bind(Object.prototype.toString),d=Function.prototype.call.bind(Object.prototype.hasOwnProperty),h=Object.fromEntries(["Object","Number","String","Array","URLSearchParams","FormData"].map((e=>[e,`[object ${e}]`])));var b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function y(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}var g,m,v={exports:{}};!function(e,t){function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(t,"__esModule",{value:!0});var r=n(i.default),o=n(l.default),s=n(a.default),f=n(u.default),p=n(c.default);const d=r.Readable,h=Symbol("buffer"),y=Symbol("type");class g{constructor(){this[y]="";const e=arguments[0],t=arguments[1],n=[];let r=0;if(e){const t=e,o=Number(t.length);for(let e=0;e<o;e++){const o=t[e];let s;s=o instanceof Buffer?o:ArrayBuffer.isView(o)?Buffer.from(o.buffer,o.byteOffset,o.byteLength):o instanceof ArrayBuffer?Buffer.from(o):o instanceof g?o[h]:Buffer.from("string"==typeof o?o:String(o)),r+=s.length,n.push(s)}}this[h]=Buffer.concat(n);let o=t&&void 0!==t.type&&String(t.type).toLowerCase();o&&!/[^\u0020-\u007E]/.test(o)&&(this[y]=o)}get size(){return this[h].length}get type(){return this[y]}text(){return Promise.resolve(this[h].toString())}arrayBuffer(){const e=this[h],t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return Promise.resolve(t)}stream(){const e=new d;return e._read=function(){},e.push(this[h]),e.push(null),e}toString(){return"[object Blob]"}slice(){const e=this.size,t=arguments[0],n=arguments[1];let r,o;r=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),o=void 0===n?e:n<0?Math.max(e+n,0):Math.min(n,e);const s=Math.max(o-r,0),i=this[h].slice(r,r+s),l=new g([],{type:arguments[2]});return l[h]=i,l}}function m(e,t,n){Error.call(this,e),this.message=e,this.type=t,n&&(this.code=this.errno=n.code),Error.captureStackTrace(this,this.constructor)}let v;Object.defineProperties(g.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(g.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),m.prototype=Object.create(Error.prototype),m.prototype.constructor=m,m.prototype.name="FetchError";try{v=require("encoding").convert}catch(e){}const w=Symbol("Body internals"),j=r.PassThrough;function T(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.size;let s=void 0===o?0:o;var i=n.timeout;let l=void 0===i?0:i;null==e?e=null:S(e)?e=Buffer.from(e.toString()):P(e)||Buffer.isBuffer(e)||("[object ArrayBuffer]"===Object.prototype.toString.call(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof r||(e=Buffer.from(String(e)))),this[w]={body:e,disturbed:!1,error:null},this.size=s,this.timeout=l,e instanceof r&&e.on("error",(function(e){const n="AbortError"===e.name?e:new m(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e);t[w].error=n}))}function O(){var e=this;if(this[w].disturbed)return T.Promise.reject(new TypeError(`body used already for: ${this.url}`));if(this[w].disturbed=!0,this[w].error)return T.Promise.reject(this[w].error);let t=this.body;if(null===t)return T.Promise.resolve(Buffer.alloc(0));if(P(t)&&(t=t.stream()),Buffer.isBuffer(t))return T.Promise.resolve(t);if(!(t instanceof r))return T.Promise.resolve(Buffer.alloc(0));let n=[],o=0,s=!1;return new T.Promise((function(r,i){let l;e.timeout&&(l=setTimeout((function(){s=!0,i(new m(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))}),e.timeout)),t.on("error",(function(t){"AbortError"===t.name?(s=!0,i(t)):i(new m(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t))})),t.on("data",(function(t){if(!s&&null!==t){if(e.size&&o+t.length>e.size)return s=!0,void i(new m(`content size at ${e.url} over limit: ${e.size}`,"max-size"));o+=t.length,n.push(t)}})),t.on("end",(function(){if(!s){clearTimeout(l);try{r(Buffer.concat(n,o))}catch(t){i(new m(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t))}}}))}))}function S(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function P(e){return"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}function x(e){let t,n,o=e.body;if(e.bodyUsed)throw new Error("cannot clone body after it is used");return o instanceof r&&"function"!=typeof o.getBoundary&&(t=new j,n=new j,o.pipe(t),o.pipe(n),e[w].body=t,o=n),o}function E(e){return null===e?null:"string"==typeof e?"text/plain;charset=UTF-8":S(e)?"application/x-www-form-urlencoded;charset=UTF-8":P(e)?e.type||null:Buffer.isBuffer(e)||"[object ArrayBuffer]"===Object.prototype.toString.call(e)||ArrayBuffer.isView(e)?null:"function"==typeof e.getBoundary?`multipart/form-data;boundary=${e.getBoundary()}`:e instanceof r?null:"text/plain;charset=UTF-8"}function A(e){const t=e.body;return null===t?0:P(t)?t.size:Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}T.prototype={get body(){return this[w].body},get bodyUsed(){return this[w].disturbed},arrayBuffer(){return O.call(this).then((function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}))},blob(){let e=this.headers&&this.headers.get("content-type")||"";return O.call(this).then((function(t){return Object.assign(new g([],{type:e.toLowerCase()}),{[h]:t})}))},json(){var e=this;return O.call(this).then((function(t){try{return JSON.parse(t.toString())}catch(t){return T.Promise.reject(new m(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}}))},text(){return O.call(this).then((function(e){return e.toString()}))},buffer(){return O.call(this)},textConverted(){var e=this;return O.call(this).then((function(t){return function(e,t){if("function"!=typeof v)throw new Error("The package `encoding` must be installed to use the textConverted() function");const n=t.get("content-type");let r,o,s="utf-8";n&&(r=/charset=([^;]*)/i.exec(n));o=e.slice(0,1024).toString(),!r&&o&&(r=/<meta.+?charset=(['"])(.+?)\1/i.exec(o));!r&&o&&(r=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(o),r||(r=/<meta[\s]+?content=(['"])(.+?)\1[\s]+?http-equiv=(['"])content-type\3/i.exec(o),r&&r.pop()),r&&(r=/charset=(.*)/i.exec(r.pop())));!r&&o&&(r=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(o));r&&(s=r.pop(),"gb2312"!==s&&"gbk"!==s||(s="gb18030"));return v(e,"UTF-8",s).toString()}(t,e.headers)}))}},Object.defineProperties(T.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),T.mixIn=function(e){for(const t of Object.getOwnPropertyNames(T.prototype))if(!(t in e)){const n=Object.getOwnPropertyDescriptor(T.prototype,t);Object.defineProperty(e,t,n)}},T.Promise=b.Promise;const B=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,C=/[^\t\x20-\x7e\x80-\xff]/;function L(e){if(e=`${e}`,B.test(e)||""===e)throw new TypeError(`${e} is not a legal HTTP header name`)}function R(e){if(e=`${e}`,C.test(e))throw new TypeError(`${e} is not a legal HTTP header value`)}function $(e,t){t=t.toLowerCase();for(const n in e)if(n.toLowerCase()===t)return n}const k=Symbol("map");class U{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[k]=Object.create(null),e instanceof U){const t=e.raw(),n=Object.keys(t);for(const e of n)for(const n of t[e])this.append(e,n)}else if(null==e);else{if("object"!=typeof e)throw new TypeError("Provided initializer must be an object");{const t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw new TypeError("Header pairs must be iterable");const n=[];for(const t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("Each header pair must be iterable");n.push(Array.from(t))}for(const e of n){if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(const t of Object.keys(e)){const n=e[t];this.append(t,n)}}}}get(e){L(e=`${e}`);const t=$(this[k],e);return void 0===t?null:this[k][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=_(this),r=0;for(;r<n.length;){var o=n[r];const s=o[0],i=o[1];e.call(t,i,s,this),n=_(this),r++}}set(e,t){t=`${t}`,L(e=`${e}`),R(t);const n=$(this[k],e);this[k][void 0!==n?n:e]=[t]}append(e,t){t=`${t}`,L(e=`${e}`),R(t);const n=$(this[k],e);void 0!==n?this[k][n].push(t):this[k][e]=[t]}has(e){return L(e=`${e}`),void 0!==$(this[k],e)}delete(e){L(e=`${e}`);const t=$(this[k],e);void 0!==t&&delete this[k][t]}raw(){return this[k]}keys(){return M(this,"key")}values(){return M(this,"value")}[Symbol.iterator](){return M(this,"key+value")}}function _(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";const n=Object.keys(e[k]).sort();return n.map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[k][t].join(", ")}:function(t){return[t.toLowerCase(),e[k][t].join(", ")]})}U.prototype.entries=U.prototype[Symbol.iterator],Object.defineProperty(U.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(U.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const z=Symbol("internal");function M(e,t){const n=Object.create(q);return n[z]={target:e,kind:t,index:0},n}const q=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==q)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[z];const t=e.target,n=e.kind,r=e.index,o=_(t,n);return r>=o.length?{value:void 0,done:!0}:(this[z].index=r+1,{value:o[r],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function H(e){const t=Object.assign({__proto__:null},e[k]),n=$(e[k],"Host");return void 0!==n&&(t[n]=t[n][0]),t}Object.defineProperty(q,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const D=Symbol("Response internals"),I=o.STATUS_CODES;class F{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};T.call(this,e,t);const n=t.status||200,r=new U(t.headers);if(null!=e&&!r.has("Content-Type")){const t=E(e);t&&r.append("Content-Type",t)}this[D]={url:t.url,status:n,statusText:t.statusText||I[n],headers:r,counter:t.counter}}get url(){return this[D].url||""}get status(){return this[D].status}get ok(){return this[D].status>=200&&this[D].status<300}get redirected(){return this[D].counter>0}get statusText(){return this[D].statusText}get headers(){return this[D].headers}clone(){return new F(x(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}T.mixIn(F.prototype),Object.defineProperties(F.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(F.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const N=Symbol("Request internals"),G=s.parse,V=s.format,W="destroy"in r.Readable.prototype;function Z(e){return"object"==typeof e&&"object"==typeof e[N]}class J{constructor(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Z(e)?t=G(e.url):(t=e&&e.href?G(e.href):G(`${e}`),e={});let r=n.method||e.method||"GET";if(r=r.toUpperCase(),(null!=n.body||Z(e)&&null!==e.body)&&("GET"===r||"HEAD"===r))throw new TypeError("Request with GET/HEAD method cannot have body");let o=null!=n.body?n.body:Z(e)&&null!==e.body?x(e):null;T.call(this,o,{timeout:n.timeout||e.timeout||0,size:n.size||e.size||0});const s=new U(n.headers||e.headers||{});if(null!=o&&!s.has("Content-Type")){const e=E(o);e&&s.append("Content-Type",e)}let i=Z(e)?e.signal:null;if("signal"in n&&(i=n.signal),null!=i&&!function(e){const t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!(!t||"AbortSignal"!==t.constructor.name)}(i))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[N]={method:r,redirect:n.redirect||e.redirect||"follow",headers:s,parsedURL:t,signal:i},this.follow=void 0!==n.follow?n.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==n.compress?n.compress:void 0===e.compress||e.compress,this.counter=n.counter||e.counter||0,this.agent=n.agent||e.agent}get method(){return this[N].method}get url(){return V(this[N].parsedURL)}get headers(){return this[N].headers}get redirect(){return this[N].redirect}get signal(){return this[N].signal}clone(){return new J(this)}}function K(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}T.mixIn(J.prototype),Object.defineProperty(J.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(J.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),K.prototype=Object.create(Error.prototype),K.prototype.constructor=K,K.prototype.name="AbortError";const Y=r.PassThrough,Q=s.resolve;function X(e,t){if(!X.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return T.Promise=X.Promise,new X.Promise((function(n,s){const i=new J(e,t),l=function(e){const t=e[N].parsedURL,n=new U(e[N].headers);if(n.has("Accept")||n.set("Accept","*/*"),!t.protocol||!t.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(t.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof r.Readable&&!W)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let o=null;if(null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(o="0"),null!=e.body){const t=A(e);"number"==typeof t&&(o=String(t))}o&&n.set("Content-Length",o),n.has("User-Agent")||n.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!n.has("Accept-Encoding")&&n.set("Accept-Encoding","gzip,deflate");let s=e.agent;return"function"==typeof s&&(s=s(t)),n.has("Connection")||s||n.set("Connection","close"),Object.assign({},t,{method:e.method,headers:H(n),agent:s})}(i),a=("https:"===l.protocol?f:o).request,u=i.signal;let c=null;const d=function(){let e=new K("The user aborted a request.");s(e),i.body&&i.body instanceof r.Readable&&i.body.destroy(e),c&&c.body&&c.body.emit("error",e)};if(u&&u.aborted)return void d();const h=function(){d(),g()},b=a(l);let y;function g(){b.abort(),u&&u.removeEventListener("abort",h),clearTimeout(y)}u&&u.addEventListener("abort",h),i.timeout&&b.once("socket",(function(e){y=setTimeout((function(){s(new m(`network timeout at: ${i.url}`,"request-timeout")),g()}),i.timeout)})),b.on("error",(function(e){s(new m(`request to ${i.url} failed, reason: ${e.message}`,"system",e)),g()})),b.on("response",(function(e){clearTimeout(y);const t=function(e){const t=new U;for(const n of Object.keys(e))if(!B.test(n))if(Array.isArray(e[n]))for(const r of e[n])C.test(r)||(void 0===t[k][n]?t[k][n]=[r]:t[k][n].push(r));else C.test(e[n])||(t[k][n]=[e[n]]);return t}(e.headers);if(X.isRedirect(e.statusCode)){const r=t.get("Location"),o=null===r?null:Q(i.url,r);switch(i.redirect){case"error":return s(new m(`uri requested responds with a redirect, redirect mode is set to error: ${i.url}`,"no-redirect")),void g();case"manual":if(null!==o)try{t.set("Location",o)}catch(e){s(e)}break;case"follow":if(null===o)break;if(i.counter>=i.follow)return s(new m(`maximum redirect reached at: ${i.url}`,"max-redirect")),void g();const r={headers:new U(i.headers),follow:i.follow,counter:i.counter+1,agent:i.agent,compress:i.compress,method:i.method,body:i.body,signal:i.signal,timeout:i.timeout,size:i.size};return 303!==e.statusCode&&i.body&&null===A(i)?(s(new m("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void g()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==i.method)||(r.method="GET",r.body=void 0,r.headers.delete("content-length")),n(X(new J(o,r))),void g())}}e.once("end",(function(){u&&u.removeEventListener("abort",h)}));let r=e.pipe(new Y);const o={url:i.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:i.size,timeout:i.timeout,counter:i.counter},l=t.get("Content-Encoding");if(!i.compress||"HEAD"===i.method||null===l||204===e.statusCode||304===e.statusCode)return c=new F(r,o),void n(c);const a={flush:p.Z_SYNC_FLUSH,finishFlush:p.Z_SYNC_FLUSH};if("gzip"==l||"x-gzip"==l)return r=r.pipe(p.createGunzip(a)),c=new F(r,o),void n(c);if("deflate"!=l&&"x-deflate"!=l){if("br"==l&&"function"==typeof p.createBrotliDecompress)return r=r.pipe(p.createBrotliDecompress()),c=new F(r,o),void n(c);c=new F(r,o),n(c)}else{e.pipe(new Y).once("data",(function(e){r=8==(15&e[0])?r.pipe(p.createInflate()):r.pipe(p.createInflateRaw()),c=new F(r,o),n(c)}))}})),function(e,t){const n=t.body;null===n?e.end():P(n)?n.stream().pipe(e):Buffer.isBuffer(n)?(e.write(n),e.end()):n.pipe(e)}(b,i)}))}X.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},X.Promise=b.Promise,e.exports=t=X,Object.defineProperty(t,"__esModule",{value:!0}),t.default=t,t.Headers=U,t.Request=J,t.Response=F,t.FetchError=m}(v,v.exports),m=v.exports,(g={exports:{}}).exports=function(e,t){return/^\/\//.test(e)&&(e="https:"+e),m.call(this,e,t)},b.fetch||(b.fetch=g.exports,b.Response=m.Response,b.Headers=m.Headers,b.Request=m.Request);const w=new WeakMap,j=new WeakMap;function T(e){const t=w.get(e);return console.assert(null!=t,"'this' is expected an Event object, but got",e),t}function O(e){null==e.passiveListener?e.event.cancelable&&(e.canceled=!0,"function"==typeof e.event.preventDefault&&e.event.preventDefault()):"undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener)}function S(e,t){w.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const n=Object.keys(t);for(let e=0;e<n.length;++e){const t=n[e];t in this||Object.defineProperty(this,t,P(t))}}function P(e){return{get(){return T(this).event[e]},set(t){T(this).event[e]=t},configurable:!0,enumerable:!0}}function x(e){return{value(){const t=T(this).event;return t[e].apply(t,arguments)},configurable:!0,enumerable:!0}}function E(e){if(null==e||e===Object.prototype)return S;let t=j.get(e);return null==t&&(t=function(e,t){const n=Object.keys(t);if(0===n.length)return e;function r(t,n){e.call(this,t,n)}r.prototype=Object.create(e.prototype,{constructor:{value:r,configurable:!0,writable:!0}});for(let o=0;o<n.length;++o){const s=n[o];if(!(s in e.prototype)){const e="function"==typeof Object.getOwnPropertyDescriptor(t,s).value;Object.defineProperty(r.prototype,s,e?x(s):P(s))}}return r}(E(Object.getPrototypeOf(e)),e),j.set(e,t)),t}function A(e){return T(e).immediateStopped}function B(e,t){T(e).passiveListener=t}S.prototype={get type(){return T(this).event.type},get target(){return T(this).eventTarget},get currentTarget(){return T(this).currentTarget},composedPath(){const e=T(this).currentTarget;return null==e?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return T(this).eventPhase},stopPropagation(){const e=T(this);e.stopped=!0,"function"==typeof e.event.stopPropagation&&e.event.stopPropagation()},stopImmediatePropagation(){const e=T(this);e.stopped=!0,e.immediateStopped=!0,"function"==typeof e.event.stopImmediatePropagation&&e.event.stopImmediatePropagation()},get bubbles(){return Boolean(T(this).event.bubbles)},get cancelable(){return Boolean(T(this).event.cancelable)},preventDefault(){O(T(this))},get defaultPrevented(){return T(this).canceled},get composed(){return Boolean(T(this).event.composed)},get timeStamp(){return T(this).timeStamp},get srcElement(){return T(this).eventTarget},get cancelBubble(){return T(this).stopped},set cancelBubble(e){if(!e)return;const t=T(this);t.stopped=!0,"boolean"==typeof t.event.cancelBubble&&(t.event.cancelBubble=!0)},get returnValue(){return!T(this).canceled},set returnValue(e){e||O(T(this))},initEvent(){}},Object.defineProperty(S.prototype,"constructor",{value:S,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.Event&&(Object.setPrototypeOf(S.prototype,window.Event.prototype),j.set(window.Event.prototype,S));const C=new WeakMap;function L(e){return null!==e&&"object"==typeof e}function R(e){const t=C.get(e);if(null==t)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return t}function $(e,t){Object.defineProperty(e,`on${t}`,function(e){return{get(){let t=R(this).get(e);for(;null!=t;){if(3===t.listenerType)return t.listener;t=t.next}return null},set(t){"function"==typeof t||L(t)||(t=null);const n=R(this);let r=null,o=n.get(e);for(;null!=o;)3===o.listenerType?null!==r?r.next=o.next:null!==o.next?n.set(e,o.next):n.delete(e):r=o,o=o.next;if(null!==t){const o={listener:t,listenerType:3,passive:!1,once:!1,next:null};null===r?n.set(e,o):r.next=o}},configurable:!0,enumerable:!0}}(t))}function k(e){function t(){U.call(this)}t.prototype=Object.create(U.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(let n=0;n<e.length;++n)$(t.prototype,e[n]);return t}function U(){if(!(this instanceof U)){if(1===arguments.length&&Array.isArray(arguments[0]))return k(arguments[0]);if(arguments.length>0){const e=new Array(arguments.length);for(let t=0;t<arguments.length;++t)e[t]=arguments[t];return k(e)}throw new TypeError("Cannot call a class as a function")}C.set(this,new Map)}U.prototype={addEventListener(e,t,n){if(null==t)return;if("function"!=typeof t&&!L(t))throw new TypeError("'listener' should be a function or an object.");const r=R(this),o=L(n),s=(o?Boolean(n.capture):Boolean(n))?1:2,i={listener:t,listenerType:s,passive:o&&Boolean(n.passive),once:o&&Boolean(n.once),next:null};let l=r.get(e);if(void 0===l)return void r.set(e,i);let a=null;for(;null!=l;){if(l.listener===t&&l.listenerType===s)return;a=l,l=l.next}a.next=i},removeEventListener(e,t,n){if(null==t)return;const r=R(this),o=(L(n)?Boolean(n.capture):Boolean(n))?1:2;let s=null,i=r.get(e);for(;null!=i;){if(i.listener===t&&i.listenerType===o)return void(null!==s?s.next=i.next:null!==i.next?r.set(e,i.next):r.delete(e));s=i,i=i.next}},dispatchEvent(e){if(null==e||"string"!=typeof e.type)throw new TypeError('"event.type" should be a string.');const t=R(this),n=e.type;let r=t.get(n);if(null==r)return!0;const o=function(e,t){return new(E(Object.getPrototypeOf(t)))(e,t)}(this,e);let s=null;for(;null!=r;){if(r.once?null!==s?s.next=r.next:null!==r.next?t.set(n,r.next):t.delete(n):s=r,B(o,r.passive?r.listener:null),"function"==typeof r.listener)try{r.listener.call(this,o)}catch(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e)}else 3!==r.listenerType&&"function"==typeof r.listener.handleEvent&&r.listener.handleEvent(o);if(A(o))break;r=r.next}return B(o,null),function(e,t){T(e).eventPhase=t}(o,0),function(e,t){T(e).currentTarget=t}(o,null),!o.defaultPrevented}},Object.defineProperty(U.prototype,"constructor",{value:U,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.EventTarget&&Object.setPrototypeOf(U.prototype,window.EventTarget.prototype);class AbortSignal extends U{constructor(){throw super(),new TypeError("AbortSignal cannot be constructed directly")}get aborted(){const e=_.get(this);if("boolean"!=typeof e)throw new TypeError("Expected 'this' to be an 'AbortSignal' object, but got "+(null===this?"null":typeof this));return e}}$(AbortSignal.prototype,"abort");const _=new WeakMap;Object.defineProperties(AbortSignal.prototype,{aborted:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(AbortSignal.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"});class z{constructor(){M.set(this,function(){const e=Object.create(AbortSignal.prototype);return U.call(e),_.set(e,!1),e}())}get signal(){return q(this)}abort(){var e;e=q(this),!1===_.get(e)&&(_.set(e,!0),e.dispatchEvent({type:"abort"}))}}const M=new WeakMap;function q(e){const t=M.get(e);if(null==t)throw new TypeError("Expected 'this' to be an 'AbortController' object, but got "+(null===e?"null":typeof e));return t}Object.defineProperties(z.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(z.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"});const H=y(Object.freeze({__proto__:null,default:z,AbortController:z,AbortSignal:AbortSignal})),D="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==b?b:void 0;var I;D&&(void 0===D.AbortController&&(D.AbortController=H.AbortController),void 0===D.AbortSignal&&(D.AbortSignal=H.AbortSignal));class F{static init(e,t){globalThis[(null==e?void 0:e.newName)||"Api"]=new N(W(F.baseConfig,e),t)}static create(e,t){return new N(W(F.baseConfig,e),t)}}F.baseConfig={method:"GET",bodyMixin:"json",headers:{"Content-Type":"application/json"},enableAbort:!1,pureResponse:!1};class N{constructor(e,t){this.aborts={},this.request=new G,this.response=new G;for(const[n,r]of Object.entries(t)){let t,o={};"string"==typeof r||"function"==typeof r?t=r:({urn:t,config:o={}}=r),e.methodInName&&(e.method=e.methodInName(n));const s=W(e,o);let i,l;const a=null==s?void 0:s.enableAbort;a&&(i=new AbortController,l=i.signal,s.signal=l,this.aborts[n]=[i,l]),this[n]=async(r,u,c={})=>{var f;let p=!1;const d=W(s,c),h=Z(t,d,u);h.pathname+=null!==(f=null==d?void 0:d.suffix)&&void 0!==f?f:"";const b=null!=r?J(h,d,r):h;for(const s of this.request)for(const i of s)p||"function"!=typeof i||(p=await i(b,d,[r,u,c],[n,t,o,e]));return new Promise(((e,t)=>{if(p)return void t(p);const n=t=>{p=!0,e(t)},r=e=>{p=!0,t(e)};"number"==typeof a&&(l.timeout=a,setTimeout((()=>i.abort()),a));const o=new Request(b.toString(),d);fetch(o.clone()).then((async s=>{for(const e of this.response)for(const t of e)if("function"==typeof t&&await t(s.clone(),o.clone(),[n,r]),p)return;V([e,t],s,null==d?void 0:d.bodyMixin,null==d?void 0:d.pureResponse)})).catch((e=>{"AbortError"===e.name&&"number"==typeof a&&(e.timeout=a),t(e)}))}))}}}}class G{constructor(){I.set(this,{}),this.use=(...e)=>{let t,n;return"function"!=typeof e[0]?(t=Math.abs(Math.trunc(e[0])),n=e.slice(1)):(t=0,n=e),d(f(this,I,"f"),t)?f(this,I,"f")[t].push(...n):f(this,I,"f")[t]=Array.from(n),[t,n]},this.eject=([e,t])=>{var n,r;let o,s;"function"!=typeof e?(o=Math.abs(Math.trunc(e)),s=t):(o=null!==(r=null===(n=Object.keys(this.pipeMap))||void 0===n?void 0:n[0])&&void 0!==r?r:0,s=[e].concat(t));const i=Array(s.length).fill(!1);return f(this,I,"f")[o]=f(this,I,"f")[o].filter((e=>{const t=s.indexOf(e);return-1===t||(i[t]=!0,!1)})),i}}*[(I=new WeakMap,Symbol.iterator)](){for(const e in f(this,I,"f"))yield f(this,I,"f")[e]}}function V([e,t],n,r="json",o=!1){const s=o?n.clone():void 0;n[r]().then((t=>e(o?[t,s]:t)))}function W(e,t){const n=Object.assign({},null==e?void 0:e.headers,null==t?void 0:t.headers);return p(null==e?void 0:e.custom)===h.Object||p(null==t?void 0:t.custom)===h.Object?{...e,...t,headers:n,custom:Object.assign({},null==e?void 0:e.custom,null==t?void 0:t.custom)}:{...e,...t,headers:n}}function Z(e,t,n){var r;const o=null!==(r=null==t?void 0:t.baseURL)&&void 0!==r?r:void 0;return"function"==typeof e?new URL(e(n),o):K(n,new URL(e,o))}function J(e,t,n){return["GET","HEAD"].includes(t.method.toUpperCase())?e=K(n,e):((p(n)===h.Object||Array.isArray(n))&&(n=JSON.stringify(n)),t.body=n),e}function K(e,t){const n=p(e);if([h.Object,h.FormData,h.URLSearchParams].includes(n)){const n=t.search.includes("?");t.search+=n&&"&"!==t.search.slice(-1)[0]?"&":"",t.search+=new URLSearchParams(e).toString()}else if([h.Array,h.Number,h.String].includes(n)){const n="/"===t.pathname.slice(-1)[0];t.pathname+=(n?"":"/")+e.toString()}return t}exports.default=F,exports.urnParser=(e,...t)=>n=>e.reduce(((e,r,o)=>{var s;return e+r+(null!==(s=null==n?void 0:n[t[o]])&&void 0!==s?s:"")}),"");
