!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("isomorphic-fetch"),require("abort-controller/polyfill")):"function"==typeof define&&define.amd?define(["exports","isomorphic-fetch","abort-controller/polyfill"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).test={})}(this,(function(t){"use strict";function e(t,e,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(t):n?n.value:e.get(t)}const o=Function.prototype.call.bind(Object.prototype.toString),n=Function.prototype.call.bind(Object.prototype.hasOwnProperty),r=Object.fromEntries(["Object","Number","String","Array","URLSearchParams","FormData"].map((t=>[t,`[object ${t}]`])));var i;class s{static init(t,e){globalThis[(null==t?void 0:t.newName)||"Api"]=new c(u(s.baseConfig,t),e)}static create(t,e){return new c(u(s.baseConfig,t),e)}}s.baseConfig={method:"GET",bodyMixin:"json",headers:{"Content-Type":"application/json"},enableAbort:!1,pureResponse:!1};class c{constructor(t,e){this.aborts={},this.request=new a,this.response=new a;for(const[o,n]of Object.entries(e)){let e,r={};"string"==typeof n||"function"==typeof n?e=n:({urn:e,config:r={}}=n),t.methodInName&&(t.method=t.methodInName(o));const i=u(t,r);let s,c;const a=null==i?void 0:i.enableAbort;a&&(s=new AbortController,c=s.signal,i.signal=c,this.aborts[o]=[s,c]),this[o]=async(n,h,p={})=>{var b;let m=!1;const y=u(i,p),v=f(e,y,h);v.pathname+=null!==(b=null==y?void 0:y.suffix)&&void 0!==b?b:"";const g=null!=n?d(v,y,n):v;for(const i of this.request)for(const s of i)m||"function"!=typeof s||(m=await s(g,y,[n,h,p],[o,e,r,t]));return new Promise(((t,e)=>{if(m)return void e(m);const o=e=>{m=!0,t(e)},n=t=>{m=!0,e(t)};"number"==typeof a&&(c.timeout=a,setTimeout((()=>s.abort()),a));const r=new Request(g.toString(),y);fetch(r.clone()).then((async i=>{for(const t of this.response)for(const e of t)if("function"==typeof e&&await e(i.clone(),r.clone(),[o,n]),m)return;l([t,e],i,null==y?void 0:y.bodyMixin,null==y?void 0:y.pureResponse)})).catch((t=>{"AbortError"===t.name&&"number"==typeof a&&(t.timeout=a),e(t)}))}))}}}}class a{constructor(){i.set(this,{}),this.use=(...t)=>{let o,r;return"function"!=typeof t[0]?(o=Math.abs(Math.trunc(t[0])),r=t.slice(1)):(o=0,r=t),n(e(this,i,"f"),o)?e(this,i,"f")[o].push(...r):e(this,i,"f")[o]=Array.from(r),[o,r]},this.eject=([t,o])=>{var n,r;let s,c;"function"!=typeof t?(s=Math.abs(Math.trunc(t)),c=o):(s=null!==(r=null===(n=Object.keys(this.pipeMap))||void 0===n?void 0:n[0])&&void 0!==r?r:0,c=[t].concat(o));const a=Array(c.length).fill(!1);return e(this,i,"f")[s]=e(this,i,"f")[s].filter((t=>{const e=c.indexOf(t);return-1===e||(a[e]=!0,!1)})),a}}*[(i=new WeakMap,Symbol.iterator)](){for(const t in e(this,i,"f"))yield e(this,i,"f")[t]}}function l([t,e],o,n="json",r=!1){const i=r?o.clone():void 0;o[n]().then((e=>t(r?[e,i]:e)))}function u(t,e){const n=Object.assign({},null==t?void 0:t.headers,null==e?void 0:e.headers);return o(null==t?void 0:t.custom)===r.Object||o(null==e?void 0:e.custom)===r.Object?{...t,...e,headers:n,custom:Object.assign({},null==t?void 0:t.custom,null==e?void 0:e.custom)}:{...t,...e,headers:n}}function f(t,e,o){var n;const r=null!==(n=null==e?void 0:e.baseURL)&&void 0!==n?n:void 0;return"function"==typeof t?new URL(t(o),r):h(o,new URL(t,r))}function d(t,e,n){return["GET","HEAD"].includes(e.method.toUpperCase())?t=h(n,t):((o(n)===r.Object||Array.isArray(n))&&(n=JSON.stringify(n)),e.body=n),t}function h(t,e){const n=o(t);if([r.Object,r.FormData,r.URLSearchParams].includes(n)){const o=e.search.includes("?");e.search+=o&&"&"!==e.search.slice(-1)[0]?"&":"",e.search+=new URLSearchParams(t).toString()}else if([r.Array,r.Number,r.String].includes(n)){const o="/"===e.pathname.slice(-1)[0];e.pathname+=(o?"":"/")+t.toString()}return e}t.default=s,t.urnParser=(t,...e)=>o=>t.reduce(((t,n,r)=>{var i;return t+n+(null!==(i=null==o?void 0:o[e[r]])&&void 0!==i?i:"")}),""),Object.defineProperty(t,"__esModule",{value:!0})}));
