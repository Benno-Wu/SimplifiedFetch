# Simplified Fetch

Encapsulate a unified API request object to simplify the use of [fetch](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)

> npm i simplified-fetch

__If you like this repository, share it!__

## Usage

```ts
import API, { urnParser } from 'simplified-fetch'

// create 'Api' on globalThis/global(nodejs)
API.init({
    newName?: string, // default:'Api', just for global access
    baseURL?: string | URL,
    method?: Methods, // default:'GET', 'POST', 'PUT'...
    bodyMixin?: BodyMixin, // default:'json', 'text', 'blob', 'formData', 'arrayBuffer'
    enableAbort?: boolean | number, // abort & timeout
    pureResponse?: boolean, // default:false, whether resolved with Response.clone()
    // format: [response, pureResponse] or response
    suffix?: string, // like .do .json
},{
    someApi:{
        urn: string | function, // build in function: urnParser
        config?: BaseConfig, // same as the above first param
    },
    someApi2:{...},
})

// somewhere.js
// no import, just call
await Api.someApi(body, params)
```
```ts
// support multi instances by create
const api = API.create({...},{...})
```

>### what is BodyMixin? [body-mixin | whatwg](https://fetch.spec.whatwg.org/#body-mixin)

if you are familiar with fetch, it's just used for normal step response.json() or others.

### Examples

```js
// have a quick look at *.test.js

// todo ts examples
```

## Config & Ability

- ### default config & BaseConfig extends [RequestInit](https://fetch.spec.whatwg.org/#requestinit)
BaseConfig is just an extension of second param of fetch(resource [, init]) [MDN](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch)
```ts
{
  method: 'GET',
  bodyMixin: 'json',
  headers: {
    "Content-Type": "application/json",
  },
  enableAbort: false,
  pureResponse: false,
}
```

- ### urnParser & params
base on Template literals (Template strings) [MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals)
#### usage
mainly for transforming of 'urn' in each config
```js
// init
someApi:{
  urn: urnParser`/xxx/${0}/${1}`
}
// somewhere.js
Api.someApi(body, ['user',[1,2,3]])
// getUrl: /xxx/user/1,2,3
```
>in a way, you can do anything dynamicly on url, just set the placeholder index on, pass an Array, even an Object (index need to be string like: ${'key'} ).

ps: if you get better idea or create some beautiful way to format the url, please PR!

- ### abort & timeout
[AbortController | MDN](https://developer.mozilla.org/en-US/docs/Web/API/AbortController)

```ts
const [constroller, signal] = Api.aborts.someApi
```
>when you use as timeout, the number is accessible on signal.timeout and (error: AbortError).timeout

- ### pipeline & control
const key = Api.request.use(function)
__Synchronous executed just before fetch and after internal core operation with url & config__
>function: (url: URL, config: BaseConfig, [body, params], [someApi, urn, config, baseConfig])=>any
>>__only the change to url & config will effect,__ others are just copy from your init/create config & call params

const bool = Api.request.eject(key)
>remove specific function from request pipeline, return true means success

const key = Api.response.use(function)
__Asynchronous executed just after get Response__
>function: (response: Response, request: Request, [resolve, reject])=>any
>>__invoke resolve | reject to end pipeline__

const bool = Api.response.eject(key)
>remove specific function from response pipeline, return true means success

_pass array get array_

`control`

___request___
function return true or any message, someApi will immediate reject with that, don't forget to catch it.

___response___
invoke resolve | reject to end pipeline

- ### body
__Failed to execute 'fetch' on 'Window': Request with ！GET/HEAD！ method cannot have body.__

so body will be auto transformed by internal function to string, append to the search of URL (for type Object, FormData, urlsearchParams), or append to the pathname of URL (for type Array, String, Number).

other methods: Object and Array will be auto wrapped by JSON.stringfy()


- ## more
__read [docs](https://benno-wu.github.io/SimplifiedFetch/) or create an issue, feel free to pr on docs.__

ps: docs generated by @microsoft/api-extractor & api-documenter, may not so good.

### _you may looking for shorthand of specific method_

where is the xxx.get/post/put...?
__copy below, but config right now is still static__
```ts
API.init({...},{
    post:{
        urn:url=>url,
        config:{
            method:'POST',
            ...
        }
    }
})
// somewhere.js
Api.post(body, url)
```

# Idea & Beta

- dynamic config when invoke Api.someApi(body, param, config)
- globalThis
- runtime nodejs
- params one more usage

---
Thanks to MDN, whatwg and Many blogers.
